<!DOCTYPE HTML>
<html>
 <head>
  <title>
   Ethan's Tech Blog | Create an RSS feed with Harp
  </title>
  <meta content="text/html; charset=utf-8" http-equiv="content-type"/>
  <meta content="If you want to add an RSS feed to your website and you're using Harp, this is the post for you" name="description"/>
  <meta content="Ethan Eldridge" name="author"/>
  <meta content="RSS,feed,Harp,HarpJS,xml" name="keywords"/>
  <meta content="index, follow" name="robots"/>
  <meta content="1 month" name="revisit-after"/>
  <meta content="width=device-width, initial-scale=1, maximum-scale=1" name="viewport"/>
  <link href="//static.ethanjoachimeldridge.info/favicon.ico" rel="shortcut icon" type="image/x-icon"/>
  <link href="//static.ethanjoachimeldridge.info/favicon.ico" rel="icon" type="image/ico"/>
  <!-- Facebook Open Graph Tags -->
  <meta content="Ethan Eldridge | Create an RSS feed with Harp" property="og:title"/>
  <meta content="article" property="og:type"/>
  <meta content="//static2.ethanjoachimeldridge.info/ethan.jpeg" property="og:image"/>
  <meta content="http://www.ethanjoachimeldridge.info/" property="og:url"/>
  <meta content="If you want to add an RSS feed to your website and you're using Harp, this is the post for you" property="og:description"/>
  <!-- Twitter Card Tags -->
  <meta content="summary" name="twitter:card"/>
  <meta content="Ethan Eldridge | Create an RSS feed with Harp" name="twitter:title"/>
  <meta content="If you want to add an RSS feed to your website and you're using Harp, this is the post for you" name="twitter:description"/>
  <meta content="//static2.ethanjoachimeldridge.info/ethan.jpeg" name="twitter:image"/>
  <!-- Core CSS Scripts -->
  <link crossorigin="anonymous" href="//css.ethanjoachimeldridge.info/style.css" integrity="sha384-N5yYwPDw4cymKjw0SjwRTKGAR4pv2PWn7wUtflWwszx/tkL1rEaVQyalmX2tM3wO" rel="stylesheet"/>
  <script>
   (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-52103053-1', 'www.ethanjoachimeldridge.info');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
  </script>
 </head>
 <body>
  <header>
   <h1>
    Create an RSS feed with Harp
   </h1>
  </header>
  <div id="content">
   <a href="/tech-blog">
    Back
   </a>
   <h3>
    Creating your own RSS feed with HarpJS
   </h3>
   <p>
    A lot of people use RSS feeds to aggregate content they want to know 
about, and by offering this service from your own website or blog you 
can help distribute your content a little bit easier to the tech-savvy 
world. The other day one of my friends asked me if
    <strong>
     my
    </strong>
    website had an 
RSS feed.
   </p>
   <p>
    It does now. And I'm going to show you how to do get your own.
   </p>
   <p>
    As you know if you've read my
    <a href="harp-and-smut.html">
     previous posts
    </a>
    I use
    <a href="http://harpjs.com">
     HarpJS
    </a>
    to compile 
my website whenever I create new content. Harp let's you use EJS or Jade 
to template your website and supports a lot of different content types 
out of the box. Specifically, I write everything in
    <a href="http://daringfireball.net/projects/markdown/syntax">
     markdown
    </a>
    because I 
love it, and luckily for you and your RSS feed, Harp supports creating 
XML documents as well, including templating.
   </p>
   <p>
    This is the full code that generates
    <a href="feed.xml">
     my RSS feed
    </a>
    , obviously these types 
of things depend on the data you have constructed. In my case, each blog 
post's meta data (within
    <code>
     _data.json
    </code>
    ) includes a title,description, and 
date already. When I create a new post I add it to the
    <em>
     bottom
    </em>
    of my list, 
which means that to show a listing of each, with the latest at the top, 
I have to reverset the list first before I use it:
   </p>
   <pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"&gt;
    &lt;channel&gt;
        &lt;%
        var articles = [] 
        var highestDate = 0;

          for (var slug in public["tech-blog"]._data) { 
            public["tech-blog"]._data[slug].slug = slug

            if (slug != "index" &amp;&amp; slug != "feed" &amp;&amp; !public["tech-blog"]._data[slug].draft) {
                var obj = public["tech-blog"]._data[slug]
                obj.slug = slug
                  articles.push(obj)  
                  if (highestDate &lt; Date.parse(obj.date)) {
                      highestDate = Date.parse(obj.date)
                  }
            }
          };
        articles.reverse()
        %&gt;

        &lt;title&gt;Ethan's Techblog Feed&lt;/title&gt;
        &lt;link&gt;http://ethanjoachimeldridge.info/tech-blog/feed.xml&lt;/link&gt;
        &lt;description&gt;XML RSS 2.0 feed for Ethan Eldridge's tech blog&lt;/description&gt;
        &lt;managingEditor&gt;ejayeldridge@gmail.com (Ethan Eldridge)&lt;/managingEditor&gt;
        &lt;webMaster&gt;ejayeldridge@gmail.com(Ethan Eldridge)&lt;/webMaster&gt;
        &lt;lastBuildDate&gt;&lt;%= new Date(highestDate).toGMTString() %&gt;&lt;/lastBuildDate&gt;
        &lt;language&gt;en-us&lt;/language&gt;
        &lt;atom:link href="http://ethanjoachimeldridge.info/tech-blog/feed.xml" rel="self" type="application/rss+xml" /&gt;

        &lt;% for (articleIdx in articles) { %&gt;
        &lt;item&gt;
            &lt;title&gt;&lt;%- articles[articleIdx].title %&gt;&lt;/title&gt;
            &lt;link&gt;http://ethanjoachimeldridge.info/tech-blog/&lt;%= articles[articleIdx].slug %&gt;&lt;/link&gt;
            &lt;guid&gt;http://ethanjoachimeldridge.info/tech-blog/&lt;%= articles[articleIdx].slug %&gt;&lt;/guid&gt;
            &lt;pubDate&gt;&lt;%= new Date(Date.parse(articles[articleIdx].date)).toGMTString() %&gt;&lt;/pubDate&gt;
            &lt;description&gt;
                ![CDATA[&lt;%- articles[articleIdx].description.trim()
                    .replace(/[\u00A0-\u9999&lt;&gt;\&amp;]/gim, function(i) {
                        if(i.charCodeAt(0) == '&lt;'){
                            console.log(i)
                        }
                           return '&amp;#'+i.charCodeAt(0)+';';
                    }).replace(/&amp;/gim, '&amp;amp;') 
                %&gt;]]
            &lt;/description&gt;
        &lt;/item&gt;
        &lt;% } %&gt;
    &lt;/channel&gt;
&lt;/rss&gt;
</code></pre>
   <p>
    Next, the
    <code>
     xml
    </code>
    ,
    <code>
     rss
    </code>
    , and
    <code>
     channel
    </code>
    elements are part of the
    <a href="http://cyber.law.harvard.edu/rss/rss.html">
     standard
    </a>
    and easily implemented using the examples they give you. Same with the 
feed description itself with the title, link, and editor tags. There are 
only two items that stood out when creating this feed.
   </p>
   <h4>
    The timestamps for date.
   </h4>
   <p>
    The date's need to be valid
    <a href="http://www.w3.org/Protocols/rfc822/">
     RFC 822
    </a>
    timestamps. This means
    <em>
     GMT
    </em>
    time. 
If I were to not call the
    <code>
     toGMTString()
    </code>
    function on my dates, then I 
would have an invalid feed because I'd get things like this:
   </p>
   <pre><code>Fri Dec 19 2014 08:41:43 GMT-0500 (EST)
</code></pre>
   <p>
    Instead of formats like this:
   </p>
   <pre><code>Fri, 19 Dec 2014 13:42:05 GMT
</code></pre>
   <p>
    If you're using something like
    <a href="http://feedvalidator.org/">
     FeedValidator
    </a>
    to make sure your feed is
    <a href="http://feedvalidator.org/check.cgi?url=http%3A//ethanjoachimeldridge.info/tech-blog/feed.xml">
     valid
    </a>
    , then it will complain unless you use the GMT versions.
   </p>
   <h4>
    Links in the Description tag
   </h4>
   <p>
    In your RSS feed, if you're going to put more than just text, you need to
encode the entities of the data and put them into a
    <code>
     CDATA
    </code>
    block. The 
spec page links to
    <a href="http://cyber.law.harvard.edu/rss/encodingDescriptions.html">
     how to format
    </a>
    your links, but to do it you need some 
tomfoolery with javascript. Namely this:
   </p>
   <pre><code>&lt;description&gt;
    ![CDATA[&lt;%- articles[articleIdx].description.trim()
        .replace(/[\u00A0-\u9999&lt;&gt;\&amp;]/gim, function(i) {
            if(i.charCodeAt(0) == '&lt;'){
                console.log(i)
            }
                return '&amp;#'+i.charCodeAt(0)+';';
        }).replace(/&amp;/gim, '&amp;amp;') 
    %&gt;]]
&lt;/description&gt;
</code></pre>
   <p>
    This replaces all the unicode characters (outside of 127 range) with 
their corresponding character code, then turns them into entities. There 
is a
    <a href="http://stackoverflow.com/questions/18749591/encode-html-entities-in-javascript">
     stackoverflow
    </a>
    post describing this in more detail. However, the 
answer doesn't mention the
    <code>
     .replace(/&amp;/gim, '&amp;amp;')
    </code>
    part, only the
    <a href="http://jsfiddle.net/E3EqX/13/">
     fiddle
    </a>
    does.
   </p>
   <p>
    Once you have these two gotchas under control then you'll be happily displaying 
your shiny valid RSS feed image in no time!
   </p>
   <p>
    <a href="http://feedvalidator.org/check.cgi?url=http%3A//ethanjoachimeldridge.info/tech-blog/feed.xml">
     <img alt="[Valid RSS]" src="/images/tech-blog/valid-rss-rogers.png" title="Validate my RSS feed"/>
    </a>
   </p>
   <h3>
    Other Posts
   </h3>
   <div id="other-posts">
    <ul>
     <li>
      <a href="change-wp-login-wp">
       Change Wordpress login URL
      </a>
     </li>
     <li>
      <a href="gotodocumentation-sublime-chromium-default">
       Setting Chromium as the default browser for GotoDocumentation in Sublime Text 2
      </a>
     </li>
     <li>
      <a href="exifstrip-context-nautilus">
       Context Menu Button to remove Exif Metadata
      </a>
     </li>
     <li>
      <a href="proxy-paranoia-and-resolve">
       Proxy Paranoia and DNS resolves
      </a>
     </li>
     <li>
      <a href="registration-denial-wordpress">
       Deny spam emails from registering in WordPress
      </a>
     </li>
     <li>
      <a href="mailing-list">
       Make your own Mailing List
      </a>
     </li>
    </ul>
   </div>
   <div id="disqus_thread">
   </div>
   <script type="text/javascript">
    var disqus_shortname = 'ejehardenberg';
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
   </script>
   <noscript>
    Please enable JavaScript to view the
    <a href="http://disqus.com/?ref_noscript">
     comments powered by Disqus.
    </a>
   </noscript>
   <a class="dsq-brlink" href="http://disqus.com">
    <!--
-->
    comments powered by
    <span class="logo-disqus">
     Disqus
    </span>
   </a>
  </div>
  <nav>
   <ul>
    <li>
     <a href="/index">
      <img height="32px" src="//static1.ethanjoachimeldridge.info/california.jpg" width="32px"/>
      <!--
-->
      <span>
       Home
      </span>
     </a>
    </li>
    <li>
     <a href="/about">
      <img height="32px" src="//static2.ethanjoachimeldridge.info/ethan.jpeg" width="32px"/>
      <!--
-->
      <span>
       About me
      </span>
     </a>
    </li>
    <li>
     <a href="/projects">
      <img height="32px" src="//static3.ethanjoachimeldridge.info/project.png" width="32px"/>
      <!--
-->
      <span>
       Projects
      </span>
     </a>
    </li>
    <li>
     <a href="/resume">
      <img height="32px" src="//static4.ethanjoachimeldridge.info/cv.png" width="32px"/>
      <!--
-->
      <span>
       Resume
      </span>
     </a>
    </li>
    <li>
     <a href="/tech-blog">
      <img height="32px" src="//static5.ethanjoachimeldridge.info/tech-blog.png" width="32px"/>
      <!--
-->
      <span>
       Tech Blog
      </span>
     </a>
    </li>
    <li>
     <a href="/cooking">
      <img height="32px" src="//static6.ethanjoachimeldridge.info/cooking.jpg" width="32px"/>
      <!--
-->
      <span>
       Cooking
      </span>
     </a>
    </li>
    <li>
     <a href="/writing">
      <img height="32px" src="//static7.ethanjoachimeldridge.info/writing.png" width="32px"/>
      <!--
-->
      <span>
       Writing
      </span>
     </a>
    </li>
    <li>
     <a href="/contact">
      <img height="32px" src="//static.ethanjoachimeldridge.info/contact.png" width="32px"/>
      <!--
-->
      <span>
       Contact
      </span>
     </a>
    </li>
    <li>
     <a href="/writing/political">
      <img height="32px" src="//static1.ethanjoachimeldridge.info/politics.png" width="32px"/>
      <!--
-->
      <span>
       Opinion
      </span>
     </a>
    </li>
    <li>
     <a href="https://github.com/EdgeCaseBerg">
      <img height="32px" src="//static2.ethanjoachimeldridge.info/github.png" width="32px"/>
      <!--
-->
      <span>
       Github
      </span>
     </a>
    </li>
    <li>
     <a href="https://twitter.com/TheR3dLily">
      <img height="32px" src="//static3.ethanjoachimeldridge.info/twitter-bird-light-bgs.png" width="32px"/>
      <!--
-->
      <span>
       @TheR3dLily
      </span>
     </a>
    </li>
    <li>
     <a href="http://www.linkedin.com/profile/view?id=151414806">
      <img height="32px" src="//static4.ethanjoachimeldridge.info/LinkedIn_logo.png" width="32px"/>
      <!--
-->
      <span>
       LinkedIn
      </span>
     </a>
    </li>
   </ul>
  </nav>
 </body>
</html>