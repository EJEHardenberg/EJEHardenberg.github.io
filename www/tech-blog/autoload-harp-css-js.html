<!DOCTYPE HTML>
<html>
 <head>
  <title>
   Ethan's Tech Blog | Autoload your CSS and Javascript in Harp
  </title>
  <meta content="text/html; charset=utf-8" http-equiv="content-type"/>
  <meta content="In a follow up to the last post, I'll show you how to use the same technique to load both CSS and Javascript" name="description"/>
  <meta content="Ethan Eldridge" name="author"/>
  <meta content="Harp,HarpJS,javascript,dynamic,autoload,recipe,Ethan,Eldridge" name="keywords"/>
  <meta content="index, follow" name="robots"/>
  <meta content="1 month" name="revisit-after"/>
  <meta content="width=device-width, initial-scale=1, maximum-scale=1" name="viewport"/>
  <link href="//static.ethanjoachimeldridge.info/favicon.ico" rel="shortcut icon" type="image/x-icon"/>
  <link href="//static.ethanjoachimeldridge.info/favicon.ico" rel="icon" type="image/ico"/>
  <!-- Facebook Open Graph Tags -->
  <meta content="Ethan Eldridge | Autoload your CSS and Javascript in Harp" property="og:title"/>
  <meta content="article" property="og:type"/>
  <meta content="//static.ethanjoachimeldridge.info/ethan.jpeg" property="og:image"/>
  <meta content="http://www.ethanjoachimeldridge.info/" property="og:url"/>
  <meta content="In a follow up to the last post, I'll show you how to use the same technique to load both CSS and Javascript" property="og:description"/>
  <!-- Twitter Card Tags -->
  <meta content="summary" name="twitter:card"/>
  <meta content="Ethan Eldridge | Autoload your CSS and Javascript in Harp" name="twitter:title"/>
  <meta content="In a follow up to the last post, I'll show you how to use the same technique to load both CSS and Javascript" name="twitter:description"/>
  <meta content="//static.ethanjoachimeldridge.info/ethan.jpeg" name="twitter:image"/>
  <!-- Core CSS Scripts -->
  <link href="https://fonts.googleapis.com/css?family=EB+Garamond" rel="stylesheet" type="text/css"/>
  <link crossorigin="anonymous" href="//css.ethanjoachimeldridge.info/style.css" integrity="sha384-Yk6fMSCCTCPyHYaY4h661zZEU59LSxS2pX0b+B1jG+4atCz2yx/YhiimkVlATCwk" rel="stylesheet"/>
  <script>
   (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-52103053-1', 'www.ethanjoachimeldridge.info');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
  </script>
 </head>
 <body>
  <header>
   <h1>
    Autoload your CSS and Javascript in Harp
   </h1>
  </header>
  <div id="content">
   <a href="/tech-blog">
    Back
   </a>
   <h3>
    Auto loading resource files in Harp
   </h3>
   <p>
    <strong>
     An example Harp site using this technique can be found
     <a href="https://github.com/EdgeCaseBerg/harp-autoload">
      here
     </a>
    </strong>
   </p>
   <p>
    In my
    <a href="http://www.ethanjoachimeldridge.info/tech-blog/dynamically-including-js">
     previous post
    </a>
    I talked about loading javascript based on filenames or the
current path + filename. But today I was thinking to myself, why stop there? After
all, a bigger concern than javascript when you're trying to have a fast rendering
website is CSS (because it's render blocking). So we always want our CSS files to
be small, bite sized, and parsable.
   </p>
   <p>
    That's why you always see minimizers everywhere, people advocating for putting critical
CSS in the head of the document, and etc etc. And these are all good, but we're 
compiling a static site. So why don't we just cut right to the chase and only 
include what we need?
   </p>
   <p>
    Now I'm not saying do away with your primary styling file, not at all. A site should 
have a consistent theme, and that theme should be present within a master stylesheet.
    <em>
     However
    </em>
    , it's often the case that you need one or two styles that only really apply
to a single page. You can put those inline perhaps, but then we lose the ability to
use
    <a href="http://www.harpjs.com">
     Harp
    </a>
    's preprocessors like LESS.
   </p>
   <p>
    So I give you this slightly adapted partial from my previous post. All you have to 
do is set the javascript and the CSS path. (In some globals or passed to the partial,
either would work). And then you'll have CSS and Javascript automatically for one-off
styles and scripts.
   </p>
   <p>
    <em>
     _autoload.ejs
    </em>
   </p>
   <pre><code>&lt;% 
/* Auto Script for Javascript and CSS, loads a CSS/js file into the application
 * if the current file name and path match a file and path within a js or CSS
 * directory
 */
function findResource(head, tail, filter) {
    var result = false
    for (key in head) { 
        val = head[key]
        if (key == '_contents') { 
            for (i in val) { 
                file = val[i]
                if (filter.test(tail + file) ) { 
                    return true
                }
            }
        } else { 
            result = findResource(val, tail + key + "/", filter)
            if(result) return result
        }
    }
}


function resourceExists(base, ext){
    filter = new RegExp("(^/" + base + "/" + current.path.join("/")  + "\." + ext + "$)")     
    return findResource(public, "/", filter) 
}


if( resourceExists(cssBase,"CSS") ){
    %&gt;&lt;link rel="stylesheet" type="text/CSS" href="/&lt;%= cssBase + "/" + current.path.join("/") + ".CSS" %&gt;"&gt;&lt;%
}
if( resourceExists(javascriptBase,"js") ){
    %&gt;&lt;script type="text/javascript" src="/&lt;%= javascriptBase + "/" + current.path.join("/") + ".js" %&gt;"&gt;&lt;/script&gt;&lt;%
}    
%&gt;
</code></pre>
   <p>
    The code works in the same way that the
    <a href="http://www.ethanjoachimeldridge.info/tech-blog/xml-sitemap-for-harpjs">
     XML Sitemap
    </a>
    does, it traverses the tree
structure of the
    <code>
     public
    </code>
    variable and tests each file against a regular expression.
It's crazy how much use you can get out of this simple technique. Sitemaps, dynamic
inclusion, analytics (an upcoming post perhaps), you can get it all just by recycling, 
all you have to do is throw this in a partial called
    <code>
     _autoload.ejs
    </code>
    and include it 
like so:
   </p>
   <p>
    in Jade:
   </p>
   <pre><code>!= partial("_autoload")
</code></pre>
   <p>
    or EJS:
   </p>
   <pre><code>&lt;%- partial("_autoload") %&gt;
</code></pre>
   <p>
    <strong>
     An example Harp site using this technique can be found
     <a href="https://github.com/EdgeCaseBerg/harp-autoload">
      here
     </a>
    </strong>
   </p>
   <h3>
    Other Posts
   </h3>
   <div id="other-posts">
    <ul>
     <li>
      <a href="likert-scales-less-css">
       Coloring Likert Scales with LESS CSS
      </a>
     </li>
     <li>
      <a href="dynamically-including-js">
       Loading JS dynamically in Harp
      </a>
     </li>
     <li>
      <a href="using-encrypted-search-in-chromium">
       Using Encrypted Search in Chrome
      </a>
     </li>
     <li>
      <a href="cgi-c-harp-3">
       Let's make a chat server, Part 3
      </a>
     </li>
     <li>
      <a href="upgrading-chromium-33-to-37">
       Fixing the flash player in Chromium Version 37
      </a>
     </li>
     <li>
      <a href="cgi-c-harp-2">
       Let's make a chat server, Part 2
      </a>
     </li>
    </ul>
   </div>
   <div id="disqus_thread">
   </div>
   <script type="text/javascript">
    var disqus_shortname = 'ejehardenberg';
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
   </script>
   <noscript>
    Please enable JavaScript to view the
    <a href="http://disqus.com/?ref_noscript">
     comments powered by Disqus.
    </a>
   </noscript>
   <a class="dsq-brlink" href="http://disqus.com">
    <!--
-->
    comments powered by
    <span class="logo-disqus">
     Disqus
    </span>
   </a>
  </div>
  <nav>
   <ul>
    <li>
     <a href="/index">
      <span>
       Home
      </span>
     </a>
    </li>
    <li>
     <a href="/about">
      <span>
       About me
      </span>
     </a>
    </li>
    <li>
     <a href="/projects">
      <span>
       Projects
      </span>
     </a>
    </li>
    <li>
     <a href="/resume">
      <span>
       Resume
      </span>
     </a>
    </li>
    <li>
     <a href="/tech-blog">
      <span>
       Tech Blog
      </span>
     </a>
    </li>
    <li>
     <a href="/cooking">
      <span>
       Cooking
      </span>
     </a>
    </li>
    <li>
     <a href="/writing">
      <span>
       Writing
      </span>
     </a>
    </li>
    <li>
     <a href="/contact">
      <span>
       Contact
      </span>
     </a>
    </li>
    <li>
     <a href="/writing/political">
      <span>
       Opinion
      </span>
     </a>
    </li>
    <li>
     <a href="https://github.com/EdgeCaseBerg">
      <span>
       Github
      </span>
     </a>
    </li>
    <li>
     <a href="https://twitter.com/TheR3dLily">
      <span>
       Twitter
      </span>
     </a>
    </li>
    <li>
     <a href="http://www.linkedin.com/profile/view?id=151414806">
      <span>
       LinkedIn
      </span>
     </a>
    </li>
   </ul>
  </nav>
 </body>
</html>